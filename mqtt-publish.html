<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="mqtt-publish-regestration-behaviour.html">

<!--
The `mqtt-subscription` element

@demo demo/index.html
-->

<dom-module id="mqtt-publish">
  <template>
  </template>
</dom-module>

<script>

  'use strict';

  Polymer({
    is: 'mqtt-publish',

    /**
     * Fired when a publication is published.
     *
     * @event mqtt-publication-published
     * @param {{
     *   topic:  string,
     *   qos: number,
     *   retained: boolean
     * }}
     */

    properties: {

      auto: {
        type: Boolean,
        value: false
      },

      qos: {
        type: Number,
        value: 0
      },

      topic: {
        type: String,
      },

      payload: {
        type: Object,
        value: {}
      },

      published: {
        type: Boolean,
        value: false
      },

      retained: {
        type: Boolean,
        value: false
      },

    },

    behaviors: [MqttElements.MqttPublishRegestrationBehaviour],

    observers: [
        '_propertiesChanged(topic, payload, qos, retained)'
    ],

    _propertiesChanged: function(topic, payload, qos, retained){
      if (this.auto && topic && payload && this._parentConnection){
        this._parentConnection.publish(topic, payload, qos, retained);
      }
    },

    publish: function(){
      if (this.topic && this.topic.length > 0 && this.payload && this.payload.length > 0 && this._parentConnection){
        this._parentConnection.publish(this.topic, this.payload, this.qos, this.retained);
      }
    },

    _handelPublicationPublished: function() {
      this.fire("mqtt-publication-published");
    },

  });
</script>
